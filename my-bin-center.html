
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://granitosaurus.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://granitosaurus.github.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://granitosaurus.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://granitosaurus.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Blog of Bernardas Ališauskas Atom">


    <link rel="shortcut icon" href="https://granitosaurus.github.io/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://granitosaurus.github.io/images/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Bernardas Ališauskas" />
<meta name="description" content="Some of the useful things I have in my ~/bin" />
<meta name="keywords" content="python, linux, guide">
<meta property="og:site_name" content="Blog of Bernardas Ališauskas"/>
<meta property="og:title" content="My bin: center"/>
<meta property="og:description" content="Some of the useful things I have in my ~/bin"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://granitosaurus.github.io/my-bin-center.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-01-18 00:00:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://granitosaurus.github.io/author/bernardas-alisauskas.html">
<meta property="article:section" content="code"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="linux"/>
<meta property="article:tag" content="guide"/>
<meta property="og:image" content="https://granitosaurus.github.io/images/core/me.jpg">

  <title>Blog of Bernardas Ališauskas &ndash; My bin: center</title>
</head>
<body>
  <aside>
    <div>
      <a href="https://granitosaurus.github.io">
        <img class="circle" src="https://granitosaurus.github.io/images/core/me.jpg" alt="Bernardas Ališauskas" title="Bernardas Ališauskas">
      </a>
      <h1><a href="https://granitosaurus.github.io">Bernardas Ališauskas</a></h1>

<p>Python programmer and a goof who loves free software</p>
      <nav>
        <ul class="list">
          <li><a href="https://granitosaurus.github.io/pages/about.html#about">About</a></li>
          <li><a href="https://granitosaurus.github.io/pages/contact.html#contact">Contact</a></li>

        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-github" href="https://github.com/granitosaurus" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>

      <a href="http://stackoverflow.com/users/3737009">
        <img src="http://stackoverflow.com/users/flair/3737009.png" width="208" height="58" alt="Stack Overflow Profile">
      </a>
    </div>
  </aside>
  <main>
    <nav>
      <a href="https://granitosaurus.github.io">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://granitosaurus.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
    <h1 id="my-bin-center">My bin: center</h1>
    <p>
          Posted on Wed 18 January 2017 in <a href="https://granitosaurus.github.io/category/code.html">code</a>


    </p>
  </header>
  <div>
    <p>People are naturally lazy and strive to automate as much as possible. I'm no exception and my user scripts directory <code>~/bin</code> is full of scripts that make my life easier or at least makes me feel that way.  </p>
<p>Today I want to show you and explain some bits of a little python script for centering text. It's isn't particularly special, but it's a great base to show of how awesome and powerful python command line tools can be!<br>
It's a simple pipeable script that takes in some text, centers it according to your terminal size and outputs it to standard output.My use case for this is for reading poems and by default they are not centered properly. To add to that I also like to constantly resize my terminal window because I'm running <a href="http://i3wm.org/">i3wm</a> - a tilling windows manager for linux, which forces every window to use up all of the space it can, which makes them very much dynamic and unpredictable.</p>
<p>In other words it turns something like:</p>
<div class="highlight"><pre><span></span>Once upon a midnight dreary, while I pondered, weak and weary,
Over many a quaint and curious volume of forgotten lore,
While I nodded, nearly napping, suddenly there came a tapping,
As of some one gently rapping, rapping at my chamber door.
&#39;Tis some visitor,&#39; I muttered, &#39;tapping at my chamber door-
Only this, and nothing more.&#39;
</pre></div>


<p>Into:</p>
<div class="highlight"><pre><span></span>             Once upon a midnight dreary, while I pondered, weak and weary,              
                Over many a quaint and curious volume of forgotten lore,                 
             While I nodded, nearly napping, suddenly there came a tapping,              
               As of some one gently rapping, rapping at my chamber door.                
              &#39;Tis some visitor,&#39; I muttered, &#39;tapping at my chamber door-               
                              Only this, and nothing more.&#39;   
</pre></div>


<p>While taking your current terminal size into account, so no matter what you're doing or where you are the text will nice and pretty.   </p>
<h3>Source</h3>
<p>Now lets take a look at the source code:</p>
<div class="highlight"><pre><span></span>    <span class="c1">#!/usr/bin/env python3</span>
    <span class="kn">import</span> <span class="nn">click</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">shutil</span>


    <span class="nd">@click.command</span><span class="p">()</span>
    <span class="nd">@click.argument</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">))</span>
    <span class="nd">@click.argument</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
    <span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="s1">&#39;--length&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;maximum line length [default:current terminal size]&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cli</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Simple, pipeable tool for centering text&quot;&quot;&quot;</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">#1</span>
        <span class="n">source</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="k">if</span> <span class="nb">input</span> <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>  <span class="c1">#2</span>
        <span class="n">_format</span> <span class="o">=</span> <span class="s1">&#39;{{:^{}}}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>  <span class="c1">#3</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>  <span class="c1">#4</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
        <span class="n">cli</span><span class="p">()</span>
</pre></div>


<h3>Explanation</h3>
<p>I love <code>click</code> library, which is a tool for creating command line interface. It's beautiful, easy and saves so much space and time. So we start off with two positional arguments for input and output filenames, these are not necessary for pipe logic we need but is a nice addition if there's a need for standalone function.<br>
Next we have custom option for length which allows overriding maximum line length. In case you have a very huge terminal window and you just want a nice margin instead of the text being at the very center of your screen.
Finally there's the program itself:<br>
<code>#1</code> - We retrieve dimensions of the current terminal window. This returns a tuple of <code>(columns, rows)</code> since we only care about columns we take the first member. 
<code>#2</code> - We decide on which source to use for input, if first position argument is supplied to script, we'll use that as a source, otherwise use standard input.
<code>#3</code> - This might appear complicated but what we are doing here is creating a format that we will use to format every line of our text. The line evaluates to <code>{:^&lt;terminal_size&gt;}\n</code> now if we call <code>.format()</code> on that we can insert text and it will be centered. For more check out <a href="https://docs.python.org/3.1/library/string.html#string-formatting">python's string formatting</a>, it's awesome!
<code>#4</code> - And lastly we have the loop itself. Here we loop through every line, center it and either write it to file if the second positional argument is supplied or put it straight to standard output.</p>
<h3>Improvements</h3>
<p>You could probably go wild with bunch of flags and modifications but it's important to remember to KISS - keep it simple stupid. With pipes, aliases and various other shortcuts leaving this script to do one job is very much a good idea! :) </p>
<h3>Pitfalls</h3>
<p>One of the pitfalls I've experience with piping in python scripts is when piping to <code>less</code> or similar tools. <br>
Because of how <code>shutils.get_terminal_size()</code> works, if a parameter <code>fallback</code> is set, like: <code>shutils.get_terminal_size(fallback=(80,30))</code> the set fallback will actually be used instead of your terminal size if piped to <code>less</code> or similar tool.<br>
I'm not certain why it behaves like that, my guess being is that <code>less</code> breaks the terminal size function, but opposed to general recommendations of setting a fallback it's best to not set it in this case.</p>
<h3>Conclusion</h3>
<p>I'd like to encourage anyone who use ugly awk scripts and aliases just write a short command line application with click, it takes no longer than 10 minutes, is beautiful, usable, readable and easily shareable. Let me know if you have any questions and stay tuned for more scripts and explanations!</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://granitosaurus.github.io/tag/python.html">python</a>
      <a href="https://granitosaurus.github.io/tag/linux.html">linux</a>
      <a href="https://granitosaurus.github.io/tag/guide.html">guide</a>
    </p>
  </div>



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'granitosaurus';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>
  &copy; Bernardas Ališauskas 2016 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Blog of Bernardas Ališauskas ",
  "url" : "https://granitosaurus.github.io",
  "image": "https://granitosaurus.github.io/images/core/me.jpg",
  "description": "Thoughts and Writings of Granitosaurus"
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://granitosaurus.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://granitosaurus.github.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://granitosaurus.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://granitosaurus.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Blog of Bernardas Ališauskas Atom">


    <link rel="shortcut icon" href="https://granitosaurus.github.io/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://granitosaurus.github.io/images/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Bernardas Ališauskas" />
<meta name="description" content="Getting terminal size can be vital for your application, especially if you are doing some serious printing or drawing. There are some few tricks worth noting that I'd like to share." />
<meta name="keywords" content="python, linux, guide">
<meta property="og:site_name" content="Blog of Bernardas Ališauskas"/>
<meta property="og:title" content="Getting Terminal Size In Python"/>
<meta property="og:description" content="Getting terminal size can be vital for your application, especially if you are doing some serious printing or drawing. There are some few tricks worth noting that I'd like to share."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://granitosaurus.github.io/getting-terminal-size.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-01-26 00:00:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://granitosaurus.github.io/author/bernardas-alisauskas.html">
<meta property="article:section" content="code"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="linux"/>
<meta property="article:tag" content="guide"/>
<meta property="og:image" content="https://granitosaurus.github.io/images/core/me.jpg">

  <title>Blog of Bernardas Ališauskas &ndash; Getting Terminal Size In Python</title>
</head>
<body>
  <aside>
    <div>
      <a href="https://granitosaurus.github.io">
        <img class="circle" src="https://granitosaurus.github.io/images/core/me.jpg" alt="Bernardas Ališauskas" title="Bernardas Ališauskas">
      </a>
      <h1><a href="https://granitosaurus.github.io">Bernardas Ališauskas</a></h1>

<p>Python programmer and a goof who loves free software, video-games and heavy metal</p>
      <nav>
        <ul class="list">
          <li><a href="https://granitosaurus.github.io/pages/about.html#about">About</a></li>
          <li><a href="https://granitosaurus.github.io/pages/contact.html#contact">Contact</a></li>

        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-github" href="https://github.com/granitosaurus" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>

      <a href="http://stackoverflow.com/users/3737009">
        <img src="http://stackoverflow.com/users/flair/3737009.png" width="208" height="58" alt="Stack Overflow Profile">
      </a>
    </div>
  </aside>
  <main>
    <nav>
      <a href="https://granitosaurus.github.io">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://granitosaurus.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
    <h1 id="getting-terminal-size">Getting Terminal Size In Python</h1>
    <p>
          Posted on Thu 26 January 2017 in <a href="https://granitosaurus.github.io/category/code.html">code</a>


    </p>
  </header>
  <div>
    <p>Getting terminal size can be vital for your application, especially if you are doing some serious printing or drawing. However there are some few tricks worth noting that I'd like to share in this blog post.</p>
<p>First of all the recommended way or the "pythonic" way of retrieving terminal size for python3 is:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="n">columns</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">(</span><span class="n">fallback</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
</pre></div>


<p>And it works pretty great, well for the most part that is.  </p>
<h2>The Issue</h2>
<p>This particular function is just a high level wrapper around low level cpython function <code>os.get_terminal_size</code> and the only real thing it does is handle an exception and returns <code>fallback</code> values if that's the case.</p>
<p>However there's a huge pitfall with this function and it's that <strong>it doesn't work with terminal pipes!</strong>  <br>
To confirm and test that with we can try this simple script <code>size.py</code>:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">columns</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">(</span><span class="n">fallback</span><span class="o">=</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;cols:{}</span><span class="se">\n</span><span class="s1">rows:{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">rows</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>$ python size.py
cols:89
rows:22
$ python size.py <span class="p">|</span> cat
cols:123
rows:456
</pre></div>


<p>89 to 22 is my actual size however when piping to anything, including python itself, the size seems to fallback to the fallback values, which in most cases defeats the whole purpose of retrieving the terminal size.</p>
<h3>Making It Work!</h3>
<p>The solution is pretty simple - use the other function instead!<br>
If we use <code>os.get_terminal_size(0)</code> function, we'll get it working with piping too!</p>
<p>To test that lets change our script:  </p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">columns</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;cols:{}</span><span class="se">\n</span><span class="s1">rows:{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">rows</span><span class="p">))</span>
</pre></div>


<p>The thing to note here is the positional argument <code>0</code> in <code>os.get_terminal_size()</code> function, which tells which <a href="https://en.wikipedia.org/wiki/File_descriptor">file descriptor</a> to use: </p>
<blockquote>
<p>0 - Standard Input<br>
1 - Standard Output<br>
2 - Standard Error  </p>
</blockquote>
<p>By default both <code>os</code> and <code>shutil</code> functions use <code>1</code>, which stands for Standard Output. This means that if we pipe and this output detaches itself we get an OsError:</p>
<div class="highlight"><pre><span></span><span class="ne">OSError</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">25</span><span class="p">]</span> <span class="n">Inappropriate</span> <span class="n">ioctl</span> <span class="k">for</span> <span class="n">device</span>
</pre></div>


<p>This default somewhat makes sense if the size of your terminal changes when the output is displayed, but I'm having trouble even imagining an example where that would be the case.</p>
<p>So if we were to run our script now, we'd get the results we are looking for:</p>
<div class="highlight"><pre><span></span>$ python size.py
cols:89
rows:22
$ python size.py <span class="p">|</span> cat
cols:89
rows:22
<span class="c1"># Even if we pipe multiple times!</span>
$ python size.py <span class="p">|</span> grep . <span class="p">|</span> cat
cols:89
rows:22
</pre></div>


<h2>Conclusion</h2>
<p>I've spent more time than I'd like to admit trying to figure this out and the <a href="http://stackoverflow.com/a/41864359/3737009">stackoverflow thread</a> for this subject only left me more confused.<br>
As always if you have any questions, critique or notices feel free to leave a comment!</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://granitosaurus.github.io/tag/python.html">python</a>
      <a href="https://granitosaurus.github.io/tag/linux.html">linux</a>
      <a href="https://granitosaurus.github.io/tag/guide.html">guide</a>
    </p>
  </div>



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'granitosaurus';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>
  &copy; Bernardas Ališauskas 2016 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Blog of Bernardas Ališauskas ",
  "url" : "https://granitosaurus.github.io",
  "image": "https://granitosaurus.github.io/images/core/me.jpg",
  "description": "Thoughts and Writings of Granitosaurus"
}
</script>
</body>
</html>
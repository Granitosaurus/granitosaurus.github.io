<!DOCTYPE html>
<html lang="en">
<head>
        <title> Blog of Bernardas Ališauskas - Stackoverflow [scrapy] Experience: The Bad</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fork-awesome/1.1.7/css/fork-awesome.min.css">
        <link rel="stylesheet" href="https://granitosaur.us/theme/css/main.css" />
        <link href="Blog of Bernardas Ališauskas/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Blog of Bernardas Ališauskas Full Atom Feed" />
        <link href="Blog of Bernardas Ališauskas/atom.xml" type="application/atom+xml" rel="alternate" title="Blog of Bernardas Ališauskas Atom Feed" />
        <link href="Blog of Bernardas Ališauskas/rss.xml" type="application/rss+xml" rel="alternate" title="Blog of Bernardas Ališauskas RSS Feed" />
        <link href="Blog of Bernardas Ališauskas/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Blog of Bernardas Ališauskas Categories Atom Feed" />

<meta name="author" content="Bernardas Ališauskas" />
<meta name="description" content="The bad bits of my experience with stackoverflow scrapy tag" />
<meta property="og:site_name" content="Blog of Bernardas Ališauskas"/>
<meta property="og:title" content="Stackoverflow [scrapy] Experience: The Bad"/>
<meta property="og:description" content="The bad bits of my experience with stackoverflow scrapy tag"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://granitosaur.us/drafts/scrapy-stackoverflow-bad.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-09-14 00:00:00+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://granitosaur.us/author/bernardas-alisauskas.html">
<meta property="article:section" content="code"/>
<meta property="article:tag" content="scrapy"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="stackoverflow"/>
<meta property="og:image" content="http://localhost:8000/images/core/granitosaurus.png">
</head>
<body>

    <div class="navigation pure-menu pure-menu-horizontal pure-menu-scrollable">
        <a href="https://granitosaur.us">
          <img src="http://localhost:8000/images/core/granitosaurus.png" width="50"></img>
        </a>
        <a href="https://granitosaur.us/" class="pure-menu-heading  pure-menu-link">
          Blog of Bernardas Ališauskas
        </a>
        <ul class="pure-menu-list">
            <li class="pure-menu-item"></li>
            <li class="pure-menu-item"><a href="/pages/about.html" class="pure-menu-link">about</a></li>
              <li class="pure-menu-item"><a href="https://granitosaur.us/category/code.html" class="pure-menu-link">code</a></li>
              <li class="pure-menu-item"><a href="https://granitosaur.us/category/self.html" class="pure-menu-link">self</a></li>
              <li class="pure-menu-item pure-menu-selected">
                <a href="atom.xml" class="pure-menu-link">
                  <i class="fa fa-rss" aria-hidden="true"></i>
                </a>
              </li>
        </ul>
    </div>
<div class="page-container">
  <div class="entry-content">
    <div class="post-meta pure-g">
<div class="pure-u-3-4 meta-data">
    <a href="https://granitosaur.us/category/code.html" class="category">code</a>
    &mdash; 
    <span title="2016-09-14T00:00:00+02:00">Wed 14 September 2016</span></br>
    <a href="https://granitosaur.us/tag/scrapy.html" class="tag">scrapy</a>
    <a href="https://granitosaur.us/tag/python.html" class="tag">python</a>
    <a href="https://granitosaur.us/tag/stackoverflow.html" class="tag">stackoverflow</a>
    </br>
</div>    </div>
  </div>
  <div class="article-header-container">
    <div class="background-image-container title">
      <div class="background-image-small">
        <div class="title-container">
          <h1>Stackoverflow [scrapy] Experience: The Bad</h1>
        </div>
      </div>
    </div>
    <div class="entry-content article">
      <!--insert table of contents between text and first header-->
      <p><em>"People suck at asking questions"</em></p>
<p>After spending over a month answering <a href="https://github.com/scrapy/scrapy"><code>scrapy</code></a> related questions I've decided to share my experience. I'll point out few things that I've learned from this little experiment and few other related comments. The quote above is a good generalization but there are a lot of good and interesting to add, for that see my previous post.</p>

      <h1 id="the-bad">The Bad</h1>
<p><img alt="scrapy stackoverflow generic question" src="https://granitosaur.us/images/scrapy_stackoverflow2.png"/><br/>
The question quality is pretty poor, even compared to general stackoverflow quality. A lot of questions don't seem to be focused on general solutions but on individual problems which as far as I know is against the general rules of stackoverflow. However people seems to be giving it a pass since there is no other place to get answers to questions like this (shout out to #scrapy @ freenode).  </p>
<h2 id="common-issues">Common Issues</h2>
<h3 id="ajax"><strong>AJAX</strong></h3>
<p><img height="100" src="https://granitosaur.us/images/scrapy_stackoverflow5.png" style="float: left;"/>By far the most common issue is dealing with AJAX. What a scary name for something so simple."Asynchronous JavaScript and XML" which in the scope of web-crawling just means <em>make request for some data</em>, in other words it's just a javascript made request that retrieves some data. Usually this is used for product urls in pagination or images urls stored on some other server.<br/>
There's a huge question that <a href="http://stackoverflow.com/questions/8550114/can-scrapy-be-used-to-scrape-dynamic-content-from-websites-that-are-using-ajax?rq=1">covers scrapy and AJAX here</a>. However I find the answers to be pretty bad and do not fully cover the issue or cover a completely different issue(see Selenium in The Ugly part).<br/>
However there is a great blog post by Scrapinghub called <a href="https://blog.scrapinghub.com/2016/06/22/scrapy-tips-from-the-pros-june-2016/">Scraping Infinite Scrolling Pages</a> which is a must read if you're new to this! </p>
<h3 id="crawlspider"><strong>CrawlSpider</strong></h3>
<p><a href="https://granitosaur.us/images/scrapy_stackoverflow3.gif"><img alt="Please stop using CrawlSpider" src="https://granitosaur.us/images/scrapy_stackoverflow4.png"/></a><br/>
I'm now sure whom to blame here, but for some magical reason everyone decided to use <a href="http://doc.scrapy.org/en/latest/topics/spiders.html#scrapy.spiders.CrawlSpider"><code>CrawlSpider</code></a> scrapy spider instead of base <code>srapy.Spider</code>.<br/>
<code>CrawlSpider</code> automates a lot of crawling logic by using <code>Rule</code> objects which have a lot of bells and whistles to configure how and what a spider should crawl. I personally dislike <code>CrawlSpider</code> but even with it's benefits it hides so much from the user that I would <strong>never recommend it to a new user</strong>. <br/>
I have the <a href="http://doc.scrapy.org/en/latest/topics/spiders.html#scrapy.spiders.CrawlSpider">documentation page</a>of it bookmarked myself because of how confusing it can get.</p>
<p>Here's a little CrawlSpider versus Spider comparison and why I think CrawlSpider is confusing for beginners:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MySpider</span><span class="p">(</span><span class="n">CrawlSpider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">'myspider'</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"http://somesite.com"</span><span class="p">)</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Rule</span><span class="p">(</span><span class="n">LinkExtractor</span><span class="p">(</span><span class="n">restrict_xpaths</span><span class="o">=</span><span class="p">[</span><span class="s1">'//a[@href]'</span><span class="p">]),</span>
             <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_item</span><span class="p">),</span>
        <span class="n">Rule</span><span class="p">(</span><span class="n">LinkExtractor</span><span class="p">(</span><span class="n">restrict_xpaths</span><span class="o">=</span><span class="p">[</span><span class="s1">'//a[@id="cat"]'</span><span class="p">]),</span>
            <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">parse_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="o">...</span>
</code></pre></div>
<p>First thing rules are confusing, here you have a list of objects that constructs another object with in it's parameters. Both of these objects can have multiple parameters which makes the whole thing super hectic and implicit.<br/>
This is how using base Spider this would look:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MySpider</span><span class="p">(</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">'myspider'</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"http://somesite.com"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">LinkExtractor</span><span class="p">(</span><span class="n">restrict_xpaths</span><span class="o">=</span><span class="p">[</span><span class="s1">'//a[@href]'</span><span class="p">])</span><span class="o">.</span><span class="n">extract_links</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="n">LinkExtractor</span><span class="p">(</span><span class="n">restrict_xpaths</span><span class="o">=</span><span class="p">[</span><span class="s1">'//a[@id="cat"]'</span><span class="p">])</span><span class="o">.</span><span class="n">extract_links</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_item</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="o">...</span>
</code></pre></div>
<p>As you can see this code is completely explicit, you could really get rid of <a href="http://doc.scrapy.org/en/latest/topics/link-extractors.html#module-scrapy.linkextractors.lxmlhtml"><code>LinkExtractors</code></a> just by using <code>response.xpath("//a[@href]").extract()</code> instead. The advantages of using <code>LinkExtractors</code> though, is that it filters outs non website files (i.e. pdf, mp3) as well as converting urls to absolute ones.
To understand this all you need is basic scrapy knowledge and the whole chain is predictable, clear and easily accessible for modification.</p>
    </div>
    <div class="entry-content footer">
      <hr>
      <div class="pure-g">
        <div class="tags pure-u-1-2">
          <a href="https://granitosaur.us/tag/scrapy.html">scrapy </a>
          <a href="https://granitosaur.us/tag/python.html">python </a>
          <a href="https://granitosaur.us/tag/stackoverflow.html">stackoverflow </a>
        </div>
      </div>

    </div>
  </div>



    <footer class="index-footer">

        <a href="/archives.html">Archives</a></li>
        <a href="/categories.html">Categories</a></li>
        <a href="/tags.html">Tags</a></li>
        <a href="https://granitosaur.us/category/code.html">code</a>
        <a href="https://granitosaur.us/category/self.html">self</a>
        <a href="atom.xml">
          <i class="fa fa-rss-square" aria-hidden="true"></i>
        </a>

    </footer>

</body>
</html>